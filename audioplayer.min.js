(function(e,t){"use strict";function n(r,i){if(e.isEmptyObject(i.sounds))throw new Error('AudioPlayer requires "sounds"');this.options=e.extend({},n.DEFAULTS,i),this.$element=e(r).hide(),this.id=this.$element.prop("id");if(!this.id)throw new Error("AduioPlayer requires an id");this.initialized=!1,this.playing=!1,this.sounds=[],this.index=-1,this.$play=e("[data-play=#"+this.id+"]",this.$element).click(e.proxy(this.play,this)),this.$pause=e("[data-pause=#"+this.id+"]",this.$element).click(e.proxy(this.pause,this)),this.$stop=e("[data-stop=#"+this.id+"]",this.$element).click(e.proxy(this.stop,this)),this.$backward=e("[data-backward=#"+this.id+"]",this.$element).click(e.proxy(this.backward,this)),this.$forward=e("[data-forward=#"+this.id+"]",this.$element).click(e.proxy(this.forward,this)),this.$random=e("[data-random=#"+this.id+"]",this.$element).click(e.proxy(this.random,this)),this.$label=e("[data-label=#"+this.id+"]",this.$element),this.update(),t.setup({url:this.options.url,onready:e.proxy(this.init,this)})}n.DEFAULTS={url:"/swf/",preferFlash:!0,autoPlay:!0,random:!1,backwardDelay:2e3,sounds:{}},n.prototype={init:function(){var n=this,r=e.proxy(this.next,this);if(this.initialized)return;this.sounds=[],e.each(this.options.sounds,function(e,i){n.sounds.push(t.createSound({id:e,url:i,onfinish:r}))}),this.initialized=!0,this.update(),this.$element.show(),this.$element.trigger("initialized.audioplayer",this.getCurrent()),typeof this.options.onready=="function"&&this.options.onready.call(this.$element),this.options.autoPlay&&this.next()},update:function(){this.$element.toggleClass("playing",this.playing),this.$play.prop("disabled",!this.initialized||!!this.playing),this.$pause.prop("disabled",!this.initialized||!this.playing),this.$stop.prop("disabled",!this.initialized||!this.playing),this.$backward.prop("disabled",!this.initialized),this.$forward.prop("disabled",!this.initialized),this.$random.prop("disabled",!this.initialized),this.$label.text(this.getCurrent()?this.getCurrent().id:"")},getCurrent:function(){return this.sounds.length?this.sounds[this.index==-1?0:this.index]:undefined},play:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.play(this.getCurrent().id),this.playing=!0,this.update(),this.$element.trigger("play.audioplayer",this.getCurrent()))},pause:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.pause(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("pause.audioplayer",this.getCurrent()))},stop:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.stop(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("stop.audioplayer",this.getCurrent()))},backward:function(e){e&&e.preventDefault(),this.getCurrent().position<this.options.backwardDelay?(this.stop(),this.index-1>=0?this.index--:this.index=this.sounds.length-1,this.$element.trigger("backward.audioplayer",this.getCurrent()),this.play()):(t.setPosition(this.getCurrent().id,0),this.$element.trigger("backward.audioplayer",this.getCurrent()))},forward:function(e){e&&e.preventDefault(),this.stop(),this.index+1<this.sounds.length?this.index++:this.index=0,this.$element.trigger("forward.audioplayer",this.getCurrent()),this.play()},random:function(e){var t=this.sounds.length,n,r;e&&e.preventDefault();if(t==1)this.stop(),this.play();else if(t==2)this.forward();else{this.stop(),n=[];for(r in this.sounds)r!=this.index&&n.push(r);this.index=n[Math.floor(Math.random()*n.length)],this.$element.trigger("random.audioplayer",this.getCurrent()),this.play()}},next:function(e){this.options.random?this.random():this.forward(),this.$element.trigger("next.audioplayer",this.getCurrent())}};var r=e.fn.audioplayer;e.fn.audioplayer=function(t){return this.each(function(){var r=e(this),i=r.data("wxr.audioplayer"),s=typeof t=="object"&&t;i||r.data("wxr.audioplayer",i=new n(this,s)),typeof t=="string"&&i[t]()})},e.fn.audioplayer.noConflict=function(){return e.fn.audioplayer=r,this}})(window.jQuery,window.soundManager);
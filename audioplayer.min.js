(function(e,t,n){"use strict";function r(n,i){this.options=e.extend({},r.DEFAULTS,i),this.$element=e(n).hide(),this.initialized=!1,this.playing=!1,this.sounds=[],this.index=-1,this.$playlist=e("[data-playlist]",this.$element),this.$label=e("[data-label]",this.$element),this.$play=e("[data-play]",this.$element),this.$pause=e("[data-pause]",this.$element),this.$stop=e("[data-stop]",this.$element),this.$backward=e("[data-backward]",this.$element),this.$forward=e("[data-forward]",this.$element),this.$random=e("[data-random]",this.$element),this.$element.on("click","[data-play]",e.proxy(this.play,this)),this.$element.on("click","[data-pause]",e.proxy(this.pause,this)),this.$element.on("click","[data-stop]",e.proxy(this.stop,this)),this.$element.on("click","[data-backward]",e.proxy(this.backward,this)),this.$element.on("click","[data-forward]",e.proxy(this.forward,this)),this.$element.on("click","[data-random]",e.proxy(this.random,this)),this.$element.on("click","[data-to]",e.proxy(this.to,this)),this.update(),t.setup({url:this.options.url,onready:e.proxy(this.init,this)})}r.DEFAULTS={url:"/vendor/schillmania/soundmanager2/swf",preferFlash:!0,autoPlay:!0,random:!1,backwardDelay:2e3},r.prototype={init:function(){var r=this,i=e.proxy(this.next,this);if(this.initialized)return;this.sounds=[],this.$playlist.find("a,button").each(function(s){var o=e(this),u=o.attr("title")||o.attr("data-title")||o.text(),a=o.attr("href")||o.attr("data-url");o.attr("data-to")===n&&o.attr("data-to",s),r.sounds.push(t.createSound({id:u,url:a,onfinish:i}))}),this.initialized=!0,this.update(),this.$element.show(),this.$element.trigger("initialized.audioplayer",this.getCurrent()),typeof this.options.onready=="function"&&this.options.onready.call(this.$element),this.options.autoPlay&&this.next()},update:function(){this.$element.toggleClass("playing",this.playing),this.$label.text(this.getCurrent()?this.getCurrent().id:""),this.$play.prop("disabled",!this.initialized||!!this.playing),this.$pause.prop("disabled",!this.initialized||!this.playing),this.$stop.prop("disabled",!this.initialized||!this.playing),this.$backward.prop("disabled",!this.initialized),this.$forward.prop("disabled",!this.initialized),this.$random.prop("disabled",!this.initialized)},getCurrent:function(){return this.sounds.length?this.sounds[this.index==-1?0:this.index]:n},play:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.play(this.getCurrent().id),this.playing=!0,this.update(),this.$element.trigger("play.audioplayer",this.getCurrent()))},pause:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.pause(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("pause.audioplayer",this.getCurrent()))},stop:function(e){e&&e.preventDefault(),this.getCurrent()&&(t.stop(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("stop.audioplayer",this.getCurrent()))},backward:function(e){e&&e.preventDefault(),this.getCurrent().position<this.options.backwardDelay?(this.stop(),this.index-1>=0?this.index--:this.index=this.sounds.length-1,this.$element.trigger("backward.audioplayer",this.getCurrent()),this.play()):(t.setPosition(this.getCurrent().id,0),this.$element.trigger("backward.audioplayer",this.getCurrent()))},forward:function(e){e&&e.preventDefault(),this.stop(),this.index+1<this.sounds.length?this.index++:this.index=0,this.$element.trigger("forward.audioplayer",this.getCurrent()),this.play()},random:function(e){var t=this.sounds.length,n,r;e&&e.preventDefault();if(t==1)this.stop(),this.play();else if(t==2)this.forward();else{this.stop(),n=[];for(r in this.sounds)r!=this.index&&n.push(r);this.index=n[Math.floor(Math.random()*n.length)],this.$element.trigger("random.audioplayer",this.getCurrent()),this.play()}},next:function(e){this.options.random?this.random():this.forward(),this.$element.trigger("next.audioplayer",this.getCurrent())},to:function(t){var n=t.target?parseInt(e(t.target).attr("data-to")):t;t.target&&t.preventDefault(),n<0?n=0:n>=this.sounds.length&&(n=this.sounds.length-1),n!=this.index&&(this.stop(),this.index=n,this.$element.trigger("to.audioplayer",this.getCurrent()),this.play())}};var i=e.fn.audioplayer;e.fn.audioplayer=function(t){return this.each(function(){var n=e(this),i=n.data("wxr.audioplayer"),s=typeof t=="object"&&t;i||n.data("wxr.audioplayer",i=new r(this,s)),typeof t=="string"&&i[t]()})},e.fn.audioplayer.noConflict=function(){return e.fn.audioplayer=i,this}})(window.jQuery,window.soundManager);
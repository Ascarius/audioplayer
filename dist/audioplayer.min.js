!function(a,b,c){"use strict";function d(c,d){this.options=a.extend({},this.DEFAULTS,d),this.$element=a(c).hide(),this.initialized=!1,this.playing=!1,this.sounds=[],this.index=-1,this.$playlist=a("[data-playlist]",this.$element),this.$label=a("[data-label]",this.$element),this.$play=a("[data-play]",this.$element),this.$pause=a("[data-pause]",this.$element),this.$stop=a("[data-stop]",this.$element),this.$backward=a("[data-backward]",this.$element),this.$forward=a("[data-forward]",this.$element),this.$random=a("[data-random]",this.$element),this.$element.on("click","[data-play]",a.proxy(this.play,this)),this.$element.on("click","[data-pause]",a.proxy(this.pause,this)),this.$element.on("click","[data-stop]",a.proxy(this.stop,this)),this.$element.on("click","[data-backward]",a.proxy(this.backward,this)),this.$element.on("click","[data-forward]",a.proxy(this.forward,this)),this.$element.on("click","[data-random]",a.proxy(this.random,this)),this.$element.on("click","[data-to]",a.proxy(this.to,this)),this.update(),b.setup({url:this.options.url,onready:a.proxy(this.init,this)})}var e=a.fn.audioplayer;a.extend(d.prototype,{DEFAULTS:{url:"/vendor/schillmania/soundmanager2/swf",preferFlash:!0,autoPlay:!0,random:!1,backwardDelay:2e3},init:function(){var d=this,e=a.proxy(this.next,this);this.initialized||(this.sounds=[],this.$playlist.find("a,button").each(function(f){var g=a(this),h=g.attr("title")||g.attr("data-title")||g.text(),i=g.attr("href")||g.attr("data-url");g.attr("data-to")===c&&g.attr("data-to",f),d.sounds.push(b.createSound({id:h,url:i,onfinish:e}))}),this.initialized=!0,this.update(),this.$element.show(),this.$element.trigger("initialized.audioplayer",this.getCurrent()),"function"==typeof this.options.onready&&this.options.onready.call(this.$element),this.options.autoPlay&&this.next())},update:function(){this.$element.toggleClass("playing",this.playing),this.$label.text(this.getCurrent()?this.getCurrent().id:""),this.$play.prop("disabled",!(this.initialized&&!this.playing)),this.$pause.prop("disabled",!(this.initialized&&this.playing)),this.$stop.prop("disabled",!(this.initialized&&this.playing)),this.$backward.prop("disabled",!this.initialized),this.$forward.prop("disabled",!this.initialized),this.$random.prop("disabled",!this.initialized)},getCurrent:function(){return this.sounds.length?this.sounds[-1==this.index?0:this.index]:c},play:function(a){a&&a.preventDefault(),this.getCurrent()&&(b.play(this.getCurrent().id),this.playing=!0,this.update(),this.$element.trigger("play.audioplayer",this.getCurrent()))},pause:function(a){a&&a.preventDefault(),this.getCurrent()&&(b.pause(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("pause.audioplayer",this.getCurrent()))},stop:function(a){a&&a.preventDefault(),this.getCurrent()&&(b.stop(this.getCurrent().id),this.playing=!1,this.update(),this.$element.trigger("stop.audioplayer",this.getCurrent()))},backward:function(a){a&&a.preventDefault(),this.getCurrent().position<this.options.backwardDelay?(this.stop(),this.index-1>=0?this.index--:this.index=this.sounds.length-1,this.$element.trigger("backward.audioplayer",this.getCurrent()),this.play()):(b.setPosition(this.getCurrent().id,0),this.$element.trigger("backward.audioplayer",this.getCurrent()))},forward:function(a){a&&a.preventDefault(),this.stop(),this.index+1<this.sounds.length?this.index++:this.index=0,this.$element.trigger("forward.audioplayer",this.getCurrent()),this.play()},random:function(a){var b,c,d=this.sounds.length;if(a&&a.preventDefault(),1==d)this.stop(),this.play();else if(2==d)this.forward();else{this.stop(),b=[];for(c in this.sounds)c!=this.index&&b.push(c);this.index=b[Math.floor(Math.random()*b.length)],this.$element.trigger("random.audioplayer",this.getCurrent()),this.play()}},next:function(a){a&&a.preventDefault(),this.options.random?this.random():this.forward(),this.$element.trigger("next.audioplayer",this.getCurrent())},to:function(b){var c=b.target?parseInt(a(b.target).attr("data-to")):b;b.target&&b.preventDefault(),0>c?c=0:c>=this.sounds.length&&(c=this.sounds.length-1),c!=this.index&&(this.stop(),this.index=c,this.$element.trigger("to.audioplayer",this.getCurrent()),this.play())}}),a.fn.audioplayer=function(b){return this.each(function(){var c=a(this),d=c.data("wxr.audioplayer"),e="object"==typeof b&&b;d||c.data("wxr.audioplayer",d=new this.Constructor(this,e)),"string"==typeof b&&d[b]()})},a.fn.audioplayer.Constructor=d,a.fn.audioplayer.noConflict=function(){return a.fn.audioplayer=e,this}}(window.jQuery,window.soundManager);